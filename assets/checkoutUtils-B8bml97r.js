var S=Object.defineProperty;var b=(t,e,r)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var m=(t,e,r)=>b(t,typeof e!="symbol"?e+"":e,r);import{o as d}from"./index-VvENCeXe.js";class p{static async makeRequest(e,r,s){const a=await fetch("https://api.novaposhta.ua/v2.0/json/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:this.apiKey,modelName:e,calledMethod:r,methodProperties:s})});if(!a.ok)throw new Error("Network response was not ok");return a.json()}static async getCities(e){return e?this.makeRequest("Address","getCities",{AreaRef:e,Limit:1e3}):this.makeRequest("Address","getAreas",{})}static async getWarehouses(e,r=1,s=50){return await this.makeRequest("Address","getWarehouses",{CityRef:e,Page:r.toString(),Limit:s.toString(),Language:"UA",TypeOfWarehouseRef:"841339c7-591a-42e2-8233-7a0a00f0ed6f"})}static async calculateShippingCost(e,r,s,a){return(await this.makeRequest("InternetDocument","getDocumentPrice",{CitySender:e,CityRecipient:r,Weight:s,Cost:a,ServiceType:"WarehouseWarehouse"})).data[0]}static async getCityByRef(e){try{const r=await this.makeRequest("Address","getCities",{Ref:e});return!r.success||!r.data||r.data.length===0?(console.error("Failed to get city data:",r),null):r.data[0]}catch(r){return console.error("Error getting city by ref:",r),null}}static async getWarehouseByRef(e){try{const r=await this.makeRequest("Address","getWarehouses",{Ref:e});return!r.success||!r.data||r.data.length===0?(console.error("Failed to get warehouse data:",r),null):r.data[0]}catch(r){return console.error("Error getting warehouse by ref:",r),null}}static async getCounterparties(e){return this.makeRequest("Counterparty","getCounterparties",{CounterpartyProperty:e,Page:"1"})}static async getCounterpartyContactPersons(e){return this.makeRequest("Counterparty","getCounterpartyContactPersons",{Ref:e})}static async saveCounterparty(e){return await this.makeRequest("Counterparty","save",e)}static async getSenderWarehouses(e){return this.makeRequest("Address","getWarehouses",{CityRef:e,TypeOfWarehouseRef:"841339c7-591a-42e2-8233-7a0a00f0ed6f"})}static async createWaybill(e,r,s,a,c){var u;const i=await this.makeRequest("InternetDocument","save",{Sender:e.Sender,CitySender:e.CitySender,SenderAddress:e.SenderAddress,ContactSender:e.ContactSender,SendersPhone:e.SendersPhone,Recipient:r.Recipient,CityRecipient:r.CityRecipient,RecipientAddress:r.RecipientAddress,ContactRecipient:r.ContactRecipient,RecipientsPhone:r.RecipientsPhone,FirstName:r.FirstName,LastName:r.LastName,MiddleName:r.MiddleName,CargoType:"Cargo",Weight:s.Weight,ServiceType:s.ServiceType,SeatsAmount:s.SeatsAmount,Description:s.Description,PayerType:a,PaymentMethod:c,DateTime:new Date().toISOString().replace("T"," ").slice(0,19)});if(!i.success||!i.data||!i.data[0])throw new Error("Nova Poshta error: "+(((u=i.errors)==null?void 0:u.join(", "))||"Unknown error"));return i.data[0].Ref}static async trackWaybill(e){return(await this.makeRequest("TrackingDocument","getStatusDocuments",{Documents:[{DocumentNumber:e}]})).data[0]}}m(p,"apiKey","7d36155ec1d70f795f80b64841d55c59");const n=[];for(let t=0;t<256;++t)n.push((t+256).toString(16).slice(1));function f(t,e=0){return(n[t[e+0]]+n[t[e+1]]+n[t[e+2]]+n[t[e+3]]+"-"+n[t[e+4]]+n[t[e+5]]+"-"+n[t[e+6]]+n[t[e+7]]+"-"+n[t[e+8]]+n[t[e+9]]+"-"+n[t[e+10]]+n[t[e+11]]+n[t[e+12]]+n[t[e+13]]+n[t[e+14]]+n[t[e+15]]).toLowerCase()}let l;const _=new Uint8Array(16);function k(){if(!l){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");l=crypto.getRandomValues.bind(crypto)}return l(_)}const N=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),w={randomUUID:N};function R(t,e,r){var a;if(w.randomUUID&&!e&&!t)return w.randomUUID();t=t||{};const s=t.random??((a=t.rng)==null?void 0:a.call(t))??k();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,f(s)}const q=t=>Number(t.reduce((e,r)=>e+r.price*r.quantity,0).toFixed(2)),P=async(t,e,r)=>{let{data:{user:s}}=await d.auth.getUser();s||(localStorage.removeItem("cart"),await d.auth.signInAnonymously(),{data:{user:s}}=await d.auth.getUser());try{const a=s.id,c=await p.getCityByRef(t.city),i=await p.getWarehouseByRef(t.warehouse);if(!c||!i)throw new Error("Failed to get city or warehouse data");const u={id:R(),user_id:a,total_amount:q(e),customer_name:t.name,customer_email:t.email,customer_phone:t.phone,shipping_address:i.Description,shipping_city:c.Description,status:"pending",waybill_number:t.waybill_number,created_at:new Date().toISOString()},{data:y,error:h}=await d.from("orders").insert(u).select().single();if(h)throw console.error("Error creating order:",h),new Error("Failed to create order");const C=e.map(o=>({order_id:y.id,product_id:o.id,quantity:o.quantity,price_at_time:Number(o.price.toFixed(2)),selected_weight:o.selectedWeight})),{error:g}=await d.from("order_items").insert(C);if(g)throw console.error("Error creating order items:",g),new Error("Failed to create order items");return{...u,items:e.map(o=>({id:R(),order_id:y.id,product_id:o.id,product_name:o.name,quantity:o.quantity,price_at_time:Number(o.price.toFixed(2)),total_price:Number((o.price*o.quantity).toFixed(2)),image_url:o.image_url}))}}catch(a){return console.error("Error in createOrder:",a),null}},v=t=>{switch(t){case"pending":return{label:"Очікує обробки",color:"yellow"};case"processing":return{label:"В обробці",color:"blue"};case"awaiting_shipment":return{label:"Очікує відправлення",color:"orange"};case"shipped":return{label:"Відправлено",color:"purple"};case"delivered":return{label:"Доставлено",color:"green"};case"cancelled":return{label:"Скасовано",color:"red"};default:return{label:"Невідомо",color:"gray"}}},T=t=>{switch(t){case"delivered":return{icon:"CheckCircle",className:"h-5 w-5 text-green-500"};case"shipped":return{icon:"Truck",className:"h-5 w-5 text-purple-500"};case"processing":return{icon:"Package",className:"h-5 w-5 text-blue-500"};case"awaiting_shipment":return{icon:"PackageCheck",className:"h-5 w-5 text-orange-500"};case"cancelled":return{icon:"XCircle",className:"h-5 w-5 text-red-500"};default:return{icon:"Clock",className:"h-5 w-5 text-yellow-500"}}};export{p as N,T as a,P as c,v as g};
