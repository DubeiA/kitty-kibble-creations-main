import{c as M,r as w,m as V,v as W,j as e,o as l}from"./index-VvENCeXe.js";import{H as q,B as f,N as B}from"./NewsletterAndFooter-CEqVmu0V.js";import{T as U,a as Y,b as F,c as T}from"./tabs-BZm2-gcK.js";import{C as z,a as J,b as K,d as Q,e as X}from"./index-BRcfsWsy.js";import{o as b,s as a,u as E,F as _,a as c,b as d,c as x,d as h,I as u,f as g,t as L}from"./input-COUR16M8.js";import{L as P}from"./loader-circle-CCt253HO.js";import"./index-ePJpB9Uz.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=M("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);b({name:a().min(2,{message:"Ім'я повинно містити мінімум 2 символи"}),email:a().email({message:"Введіть коректну email адресу"}),phone:a().min(10,{message:"Введіть коректний номер телефону"}),address:a().min(5,{message:"Введіть повну адресу доставки"}),city:a().min(2,{message:"Введіть назву міста"})});const $=b({email:a().email({message:"Введіть коректну email адресу"}),password:a().min(6,{message:"Пароль повинен містити мінімум 6 символів"})}),ee=b({name:a().min(2,{message:"Ім'я повинно містити мінімум 2 символи"}),email:a().email({message:"Введіть коректну email адресу"}),password:a().min(6,{message:"Пароль повинен містити мінімум 6 символів"}),confirmPassword:a().min(6,{message:"Пароль повинен містити мінімум 6 символів"})}).refine(p=>p.password===p.confirmPassword,{message:"Паролі не співпадають",path:["confirmPassword"]}),se="ifassp@gmail.com",ce=()=>{const[p,v]=w.useState(!1),[N,S]=w.useState(!1),[A,C]=w.useState(!1),[y,D]=w.useState(""),I=V(),{toast:n}=W(),j=E({resolver:L($),defaultValues:{email:"",password:""}}),t=E({resolver:L(ee),defaultValues:{name:"",email:"",password:"",confirmPassword:""}}),G=async s=>{var r;v(!0);try{const{data:i,error:o}=await l.auth.signInWithPassword({email:s.email,password:s.password});if(localStorage.removeItem("cart"),o)throw o;const m=i.user;if(m){const{data:ae,error:k}=await l.from("customers").select("*").eq("id",m.id).single();k&&k.code==="PGRST116"&&await l.from("customers").insert({id:m.id,email:m.email,name:((r=m.user_metadata)==null?void 0:r.name)||"",phone:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})}n({title:"Успішний вхід",description:"Ви успішно увійшли в аккаунт"}),m.email===se?I("/admin"):I("/dashboard")}catch{}finally{v(!1)}},O=async s=>{S(!0);try{const r=s.email.split("@")[1];if(!r||!["gmail.com","ukr.net","yahoo.com","outlook.com","hotmail.com","i.ua","protonmail.com"].includes(r))throw new Error("unsupported_email_domain");const{error:i,data:o}=await l.auth.signUp({email:s.email,password:s.password,options:{data:{name:s.name}}});if(i)throw i;o!=null&&o.user&&await l.from("customers").insert({id:o.user.id,email:s.email,name:s.name,phone:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),C(!0),D(s.email),n({title:"Реєстрацію майже завершено",description:"Перевірте вашу пошту і підтвердіть email-адресу щоб завершити реєстрацію."})}catch(r){console.error(r);let i="Не вдалося зареєструвати аккаунт";r.message.includes("already registered")?i="Користувач з такою email-адресою вже існує":r.message.includes("invalid")?i="Невірний формат email-адреси":r.message.includes("unsupported_email_domain")&&(i="Використовуйте тільки популярні поштові сервіси: Gmail, Ukr.net, Yahoo, Outlook, Hotmail, i.ua, Protonmail"),n({title:"Помилка реєстрації",description:i,variant:"destructive"})}finally{S(!1)}},H=async()=>{if(y)try{const{error:s}=await l.auth.resend({type:"signup",email:y});if(s)throw s;n({title:"Лист надіслано",description:"Ми надіслали вам новий лист для підтвердження email-адреси."})}catch(s){console.error(s),n({title:"Помилка",description:"Не вдалося надіслати лист. Спробуйте пізніше.",variant:"destructive"})}},R=async()=>{localStorage.removeItem("cart");const{error:s}=await l.auth.signInWithOAuth({provider:"google",options:{redirectTo:"https://dubeia.github.io/kitty-kibble-creations-main/"}});s&&n({title:"Помилка Google-авторизації",description:s.message,variant:"destructive"})};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(q,{}),e.jsx("main",{className:"flex-grow container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs(z,{children:[e.jsxs(J,{children:[e.jsx(K,{className:"text-2xl font-display",children:"Вхід до аккаунту"}),e.jsx(Q,{children:"Увійдіть або створіть аккаунт для доступу до замовлень"})]}),e.jsx(X,{children:A?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-md p-4 flex items-start gap-3",children:[e.jsx(Z,{className:"h-5 w-5 text-amber-500 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Підтвердіть email-адресу"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Ми надіслали лист підтвердження на адресу"," ",e.jsx("strong",{children:y}),". Будь ласка, перейдіть за посиланням у листі, щоб активувати аккаунт."]})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Не отримали лист?"}),e.jsx(f,{onClick:H,variant:"outline",size:"sm",children:"Надіслати повторно"})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsx(f,{variant:"ghost",className:"w-full",onClick:()=>{C(!1),j.reset(),t.reset()},children:"Повернутися до форми входу"})})]}):e.jsxs(U,{defaultValue:"login",children:[e.jsxs(Y,{className:"grid grid-cols-2 mb-8 w-full",children:[e.jsx(F,{value:"login",children:"Вхід"}),e.jsx(F,{value:"register",children:"Реєстрація"})]}),e.jsx(T,{value:"login",children:e.jsx(_,{...j,children:e.jsxs("form",{onSubmit:j.handleSubmit(G),className:"space-y-4",children:[e.jsx(c,{control:j.control,name:"email",render:({field:s})=>e.jsxs(d,{children:[e.jsx(x,{children:"Email"}),e.jsx(h,{children:e.jsx(u,{placeholder:"your@email.com",...s})}),e.jsx(g,{})]})}),e.jsx(c,{control:j.control,name:"password",render:({field:s})=>e.jsxs(d,{children:[e.jsx(x,{children:"Пароль"}),e.jsx(h,{children:e.jsx(u,{type:"password",placeholder:"Ваш пароль",...s})}),e.jsx(g,{})]})}),e.jsx(f,{type:"submit",className:"w-full",disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mr-2 h-4 w-4 animate-spin"}),"Вхід..."]}):"Увійти"})]})})}),e.jsxs(f,{type:"button",variant:"outline",className:"w-full flex items-center justify-center gap-2 mt-2",onClick:R,children:[e.jsx("img",{src:"https://www.svgrepo.com/show/475656/google-color.svg",alt:"Google",className:"w-5 h-5"}),"Увійти через Google"]}),e.jsx(T,{value:"register",children:e.jsx(_,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(O),className:"space-y-4",children:[e.jsx(c,{control:t.control,name:"name",render:({field:s})=>e.jsxs(d,{children:[e.jsx(x,{children:"Ім'я"}),e.jsx(h,{children:e.jsx(u,{placeholder:"Ваше ім'я",...s})}),e.jsx(g,{})]})}),e.jsx(c,{control:t.control,name:"email",render:({field:s})=>e.jsxs(d,{children:[e.jsx(x,{children:"Email"}),e.jsx(h,{children:e.jsx(u,{placeholder:"your@email.com",...s})}),e.jsx(g,{}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Використовуйте Gmail, Ukr.net, Yahoo, Outlook, Hotmail, i.ua або Protonmail"})]})}),e.jsx(c,{control:t.control,name:"password",render:({field:s})=>e.jsxs(d,{children:[e.jsx(x,{children:"Пароль"}),e.jsx(h,{children:e.jsx(u,{type:"password",placeholder:"Мінімум 6 символів",...s})}),e.jsx(g,{})]})}),e.jsx(c,{control:t.control,name:"confirmPassword",render:({field:s})=>e.jsxs(d,{children:[e.jsx(x,{children:"Підтвердження паролю"}),e.jsx(h,{children:e.jsx(u,{type:"password",placeholder:"Повторіть пароль",...s})}),e.jsx(g,{})]})}),e.jsx(f,{type:"submit",className:"w-full",disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mr-2 h-4 w-4 animate-spin"}),"Реєстрація..."]}):"Зареєструватися"})]})})})]})})]})})}),e.jsx(B,{})]})};export{ce as default};
